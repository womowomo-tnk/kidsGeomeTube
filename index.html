<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kids MathTube</title>

  <!-- ✅ model-viewer (スマホ強い・最短) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{
      --bg:#0f0f0f;
      --text:#f1f1f1;
      --muted:#a0a0a0;
      --chip:#272727;
      --chipActive:#f1f1f1;
      --chipActiveText:#111;
      --border:#2a2a2a;
      --accent:#ff0033;
      --cardRadius:14px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP"; background:var(--bg); color:var(--text); }

    .app{ min-height:100%; display:flex; flex-direction:column; }

    .header{
      position:sticky; top:0; z-index:50;
      background:rgba(15,15,15,0.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      padding:10px 12px;
    }
    .headerRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .brand{ display:flex; align-items:center; gap:10px; min-width:140px; }
    .playIcon{
      width:34px; height:24px; border-radius:7px; background:var(--accent);
      position:relative; box-shadow:0 6px 20px rgba(255,0,51,0.20); flex:0 0 auto;
    }
    .playIcon:before{
      content:""; position:absolute; left:13px; top:6px;
      width:0; height:0; border-top:6px solid transparent; border-bottom:6px solid transparent; border-left:10px solid #fff;
    }
    .brandTitle{ font-weight:700; font-size:15px; line-height:1; }
    .brandSubtitle{ font-size:11px; color:var(--muted); margin-top:3px; }

    .actions{ display:flex; align-items:center; gap:10px; }
    .iconBtn{
      width:36px; height:36px; border-radius:999px;
      border:1px solid var(--border); background:#151515;
      display:grid; place-items:center; cursor:pointer; user-select:none;
    }
    .iconBtn:active{ transform: translateY(1px); }
    .icon{ width:18px;height:18px; fill:#eaeaea; opacity:.95; }

    .chips{
      margin-top:10px; display:flex; gap:8px; overflow:auto; padding-bottom:2px;
      -webkit-overflow-scrolling: touch;
    }
    .chip{
      white-space:nowrap; font-size:13px; padding:8px 12px; border-radius:999px;
      background:var(--chip); border:1px solid var(--border); color:var(--text);
      cursor:pointer; user-select:none;
    }
    .chip.active{ background:var(--chipActive); color:var(--chipActiveText); border-color:transparent; }

    .feed{
      width:min(720px, 100%);
      margin:0 auto;
      padding:14px 12px 90px;
      display:flex; flex-direction:column; gap:18px;
    }

    .card{ display:flex; flex-direction:column; gap:10px; }

    /* サムネ枠 */
    .thumbSlot{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      border-radius: var(--cardRadius);
      overflow:hidden;
      border:1px solid var(--border);
      background: #101010;
    }

    /* ✅ model-viewerを枠いっぱいに */
    model-viewer.thumbModel{
      width:100%;
      height:100%;
      background: radial-gradient(circle at 30% 20%, #1c1c1c, #0a0a0a 60%);
      display:block;
      /* iOS Safariでのタッチ誤動作予防 */
      touch-action: pan-y;
    }

    /* 右下の拡大ボタン */
    .expandBtn{
      position:absolute; right:10px; bottom:10px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(10,10,10,0.70);
      color: #f1f1f1; font-size:12px;
      display:flex; align-items:center; gap:6px;
      cursor:pointer; user-select:none;
      z-index:5;
    }

    .infoRow{ display:flex; gap:10px; align-items:flex-start; }
    .avatar{ width:36px; height:36px; border-radius:999px; background:#2b2b2b; border:1px solid var(--border); }
    .meta{ min-width:0; flex:1 1 auto; }
    .title{
      font-size:15px; font-weight:700; line-height:1.25; margin:0;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    }
    .sub{ margin-top:4px; font-size:12px; color:var(--muted); }
    .kebab{
      width:36px; height:36px; border-radius:999px; border:1px solid var(--border);
      background:#151515; display:grid; place-items:center; cursor:pointer;
    }

    /* Modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,0.65);
      display:none; align-items:center; justify-content:center; padding:16px; z-index:200;
    }
    .modal.show{ display:flex; }
    .modalPanel{
      width:min(920px, 100%);
      background:#0b0b0b;
      border:1px solid #2a2a2a;
      border-radius:18px;
      overflow:hidden;
      box-shadow: 0 20px 70px rgba(0,0,0,0.6);
    }
    .modalTop{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 12px; border-bottom:1px solid #2a2a2a; background:#0f0f0f;
    }
    .modalTitle{ font-weight:700; font-size:14px; margin:0; }
    .closeBtn{
      width:36px;height:36px;border-radius:999px;border:1px solid #2a2a2a;background:#151515;color:#fff;
      cursor:pointer;font-size:18px;line-height:1;
    }
    .modalBody{
      aspect-ratio:16/9;
      background:#000;
    }
    model-viewer#expandedModel{
      width:100%;
      height:100%;
      background: radial-gradient(circle at 30% 20%, #1c1c1c, #0a0a0a 60%);
      display:block;
      touch-action: none; /* 拡大側は回転/ピンチを最大限優先 */
    }

    @media (max-width: 420px){
      .brand{ min-width:auto; }
      .brandTitle{ font-size:14px; }
      .chip{ font-size:12px; padding:7px 10px; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="headerRow">
        <div class="brand">
          <div class="playIcon" aria-hidden="true"></div>
          <div>
            <div class="brandTitle">Kids MathTube</div>
            <div class="brandSubtitle">3D Geometry Models</div>
          </div>
        </div>
        <div class="actions">
          <button class="iconBtn" type="button" aria-label="Cast">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
              <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.92-11-11-11z"/>
            </svg>
          </button>
          <button class="iconBtn" type="button" aria-label="Notifications">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6V11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5S10.5 3.17 10.5 4v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
            </svg>
          </button>
          <button class="iconBtn" type="button" aria-label="Search">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="chips" role="tablist" aria-label="Categories">
        <div class="chip active" role="tab" aria-selected="true">すべて</div>
        <div class="chip" role="tab">かたち</div>
        <div class="chip" role="tab">どうぶつ</div>
        <div class="chip" role="tab">のりもの</div>
        <div class="chip" role="tab">いろ</div>
      </div>
    </header>

    <main class="feed" id="feed"></main>
  </div>

  <!-- Modal (拡大表示) -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalPanel" role="dialog" aria-modal="true">
      <div class="modalTop">
        <p class="modalTitle" id="modalTitle">拡大表示</p>
        <button class="closeBtn" id="closeBtn" type="button" aria-label="Close">×</button>
      </div>
      <div class="modalBody">
        <!-- ✅ 拡大側はここに差し替え -->
        <model-viewer
          id="expandedModel"
          src=""
          alt="Expanded 3D"
          camera-controls
          touch-action="none"
          interaction-prompt="none"
          exposure="1"
          shadow-intensity="0.6"
          environment-image="neutral"
        ></model-viewer>
      </div>
    </div>
  </div>

  <script>
    // ✅ ここを書き換えるだけでカードのGLBを増やせる
    // 同じリポジトリに置いたGLBなら「./ファイル名.glb」でOK
    const ITEMS = [
      { title: "くるくる三角すいくん", glb: "./4tetrahedron_cute_facets_edges_vertices.glb" },
      { title: "くるくる立方体くん", glb: "./6cube_cute_facets_edges_vertices.glb" },
      { title: "くるくる8面体くん", glb: "./8octahedron_cute_smile_facets_edges_vertices.glb" },
      { title: "くるくる12面体くん", glb: "./12dodecahedron_cute_smile_facets_edges_vertices.glb" },
      { title: "くるくる20面体くん", glb: "./icosahedron_cute_faces.glb" },
      { title: "くるくるバナナくん", glb: "./icosahedron_cute_faces.glb" },
      { title: "くるくる飛行機", glb: "./icosahedron_cute_faces.glb" },
      { title: "くるくる", glb: "./icosahedron_cute_faces.glb" },
      { title: "くるくる立方体 #9", glb: "./icosahedron_cute_faces.glb" },
      { title: "くるくるバナナくん", glb: "./lv0_basicBanana3d_model.glb" },
    ];

    const feed = document.getElementById('feed');

    // カード生成
    feed.innerHTML = ITEMS.map((it, idx) => {
      const n = idx + 1;
      return `
        <article class="card" data-index="${idx}">
          <div class="thumbSlot">
            <!-- ✅ サムネ: model-viewerでGLB表示 -->
            <model-viewer
              class="thumbModel"
              src="${it.glb}"
              alt="${it.title}"
              camera-controls
              interaction-prompt="none"
              exposure="1"
              shadow-intensity="0.4"
              environment-image="neutral"
              disable-pan
              disable-tap
              min-camera-orbit="auto auto 0.2m"
              max-camera-orbit="auto auto 10m"
            ></model-viewer>

            <div class="expandBtn" data-expand="${idx}">
              <span>拡大</span>
              <svg class="icon" style="width:14px;height:14px" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H5v5zm10 9h-3v2h5v-5h-2v3zm-3-14v2h3v3h2V5h-5z"/>
              </svg>
            </div>
          </div>

          <div class="infoRow">
            <div class="avatar" aria-hidden="true"></div>
            <div class="meta">
              <p class="title">${it.title}</p>
              <div class="sub">Kids Feed ・ ${(n*1234).toLocaleString()} 回視聴 ・ ${n}日前</div>
            </div>
            <div class="kebab" aria-label="More">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 2a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0 6a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/>
              </svg>
            </div>
          </div>
        </article>
      `;
    }).join("");

    // Modal制御
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const expandedModel = document.getElementById('expandedModel');
    const closeBtn = document.getElementById('closeBtn');

    function openModal(index){
      const it = ITEMS[index];
      modalTitle.textContent = `拡大表示：${it.title}`;
      expandedModel.setAttribute('src', it.glb);
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      // 任意：閉じたら読み込みを止める（節電）
      expandedModel.setAttribute('src','');
    }

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-expand]');
      if(btn){
        openModal(Number(btn.getAttribute('data-expand')));
        return;
      }
      if(e.target === modal) closeModal();
    });
    closeBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeModal();
    });
  </script>
</body>
</html>
